/**
 * Development & Prototyping Utilities
 *
 * These utilities are for design and development only.
 * Remove this file in production builds.
 */

@layer base {
  :root {
    --font-flow-block: 'Flow Block', sans-serif;
  }
}

@layer utilities {
  /* Development Grids - Visual guides for baseline and columns */

  /* Baseline Grid - Shows horizontal lines at each baseline increment */

  .show-baseline {
    --baseline-transparency: 0.92; /* Make bg- classes slightly transparent to see grid */
    --baseline-color: color-mix(in srgb, var(--color-fg) 25%, transparent);
    --subdivision-color: color-mix(in srgb, var(--color-fg) 12%, transparent);

    /*
     * Combined grids in a single tile to prevent drift between layers.
     * Use [data-subdivisions] attribute to select 1-4 subdivisions.
     * Default: 1 subdivision (main baseline only)
     */

    /* 1 subdivision: main baseline only */
    --grid-1: linear-gradient(
      to bottom,
      transparent 0,
      transparent calc(100% - 1px),
      var(--baseline-color) calc(100% - 1px),
      var(--baseline-color) 100%
    );

    /* Default to 1 subdivision */
    background-image: var(--grid-1);
    background-size: 100% var(--line);
    background-repeat: repeat;
    background-position: 0 0;
  }

  /* 2 subdivisions: 50%, 100% */
  .show-baseline[data-subdivisions="2"] {
    --grid-2: linear-gradient(
      to bottom,
      transparent 0, transparent calc(50% - 1px),
      var(--subdivision-color) calc(50% - 1px), var(--subdivision-color) 50%,
      transparent 50%, transparent calc(100% - 1px),
      var(--baseline-color) calc(100% - 1px), var(--baseline-color) 100%
    );
    background-image: var(--grid-2);
  }

  /* 3 subdivisions: 33.33%, 66.66%, 100% */
  .show-baseline[data-subdivisions="3"] {
    --grid-3: linear-gradient(
      to bottom,
      transparent 0, transparent calc(33.333% - 1px),
      var(--subdivision-color) calc(33.333% - 1px), var(--subdivision-color) 33.333%,
      transparent 33.333%, transparent calc(66.666% - 1px),
      var(--subdivision-color) calc(66.666% - 1px), var(--subdivision-color) 66.666%,
      transparent 66.666%, transparent calc(100% - 1px),
      var(--baseline-color) calc(100% - 1px), var(--baseline-color) 100%
    );
    background-image: var(--grid-3);
  }

  /* 4 subdivisions: 25%, 50%, 75%, 100% */
  .show-baseline[data-subdivisions="4"] {
    --grid-4: linear-gradient(
      to bottom,
      transparent 0, transparent calc(25% - 1px),
      var(--subdivision-color) calc(25% - 1px), var(--subdivision-color) 25%,
      transparent 25%, transparent calc(50% - 1px),
      var(--subdivision-color) calc(50% - 1px), var(--subdivision-color) 50%,
      transparent 50%, transparent calc(75% - 1px),
      var(--subdivision-color) calc(75% - 1px), var(--subdivision-color) 75%,
      transparent 75%, transparent calc(100% - 1px),
      var(--baseline-color) calc(100% - 1px), var(--baseline-color) 100%
    );
    background-image: var(--grid-4);
  }

  /* Make bg- classes slightly transparent so grid shows through */
  .show-baseline :is([class*="bg-"]):not(.bg-transparent) {
    background-color: color-mix(
      in srgb,
      var(--bg-color) var(--baseline-transparency),
      transparent
    ) !important;
  }

  /* Column Grid - Dynamic column overlay using CSS custom property */
  /* --dev-columns, --dev-gap are set by JavaScript */
  /* --dev-margin is set responsively based on data-margin-mode attribute */

  :root {
    --dev-columns: 3;
    --dev-gap: var(--gutter);
  }

  /* Column overlay - full viewport coverage */
  #dev-column-overlay {
    position: fixed;
    inset: 0;
    left: var(--dev-margin);
    right: var(--dev-margin);
    z-index: 9998;
    pointer-events: none;
    --col-width: calc((100% - var(--dev-gap) * (var(--dev-columns) - 1)) / var(--dev-columns));
    background: repeating-linear-gradient(
      to right,
      color-mix(in srgb, var(--color-accent, #0066ff) 8%, transparent) 0,
      color-mix(in srgb, var(--color-accent, #0066ff) 8%, transparent) var(--col-width),
      transparent var(--col-width),
      transparent calc(var(--col-width) + var(--dev-gap))
    );
    display: none;
  }

  .show-columns #dev-column-overlay {
    display: block;
  }

  /* Margin overlay - shows horizontal margins */
  #dev-margin-overlay {
    position: fixed;
    inset: 0;
    z-index: 9997;
    pointer-events: none;
    background: linear-gradient(
      to right,
      color-mix(in srgb, #ff6600 15%, transparent) 0,
      color-mix(in srgb, #ff6600 15%, transparent) var(--dev-margin),
      transparent var(--dev-margin),
      transparent calc(100% - var(--dev-margin)),
      color-mix(in srgb, #ff6600 15%, transparent) calc(100% - var(--dev-margin)),
      color-mix(in srgb, #ff6600 15%, transparent) 100%
    );
    display: none;
  }

  .show-margins #dev-margin-overlay {
    display: block;
  }

  /*
   * Responsive margin modes
   * These mirror the container queries in section.css using media queries
   * Since overlays are position:fixed, we use viewport width as a proxy
   */

  /* Section mode - matches .section responsive margins */
  #dev-column-overlay[data-margin-mode="section"],
  #dev-margin-overlay[data-margin-mode="section"] {
    --dev-margin: var(--horizontal-margin, var(--line-075));
  }

  /* Full-bleed mode - no margins */
  #dev-column-overlay[data-margin-mode="full-bleed"],
  #dev-margin-overlay[data-margin-mode="full-bleed"] {
    --dev-margin: 0;
  }

  /* Wide mode - matches .section-wide responsive margins */
  #dev-column-overlay[data-margin-mode="wide"],
  #dev-margin-overlay[data-margin-mode="wide"] {
    --dev-margin: var(--line-1);
  }

  /* Highlight .grid layout primitives when dev-outline-grids is active */
  body.dev-outline-grids .grid {
    position: relative;
  }

  body.dev-outline-grids .grid::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 9997;
    pointer-events: none;
    outline: 2px solid color-mix(in srgb, var(--color-accent, #0066ff) 60%, transparent);
    outline-offset: -2px;
    /* Show columns based on the grid's actual column count and gap */
    --_gap: var(--grid-gap, var(--gutter));
    --_cols: var(--grid-columns, 3);
    background: repeating-linear-gradient(
      to right,
      color-mix(in srgb, var(--color-accent, #0066ff) 12%, transparent) 0,
      color-mix(in srgb, var(--color-accent, #0066ff) 12%, transparent) calc((100% - var(--_gap) * (var(--_cols) - 1)) / var(--_cols)),
      transparent calc((100% - var(--_gap) * (var(--_cols) - 1)) / var(--_cols)),
      transparent calc((100% - var(--_gap) * (var(--_cols) - 1)) / var(--_cols) + var(--_gap))
    );
  }

  /* Show grid info label with column count */
  body.dev-outline-grids .grid::after {
    content: 'grid (' attr(data-dev-cols) ' cols)';
    position: absolute;
    top: 0;
    left: 0;
    background: var(--color-accent, #0066ff);
    color: white;
    font-size: 10px;
    font-family: var(--font-mono, monospace);
    padding: 2px 6px;
    z-index: 9998;
    pointer-events: none;
  }

  /* Fallback for grids without data attribute */
  body.dev-outline-grids .grid:not([data-dev-cols])::after {
    content: 'grid';
  }

  /*
   * PROTOTYPING FONTS
   * Special fonts for design and prototyping
   */
  .redact .prose,
  .redact .content {
    font-family: var(--font-flow-block);
  }

  /*
   * CURRENT PAGE NAVIGATION
   * Style for active/current page in navigation
   * Uses pg-* body classes with nav link href matching
   */

  /* Header nav - primary navigation */
  header nav a[aria-current="page"],
  body.pg-home header nav a[href="/"],
  body.pg-manual header nav a[href="/manual/"],
  body.pg-docs header nav a[href="/docs/"],
  body.pg-brand-guide header nav a[href="/manual/brand/"],
  body.pg-components header nav a[href="/manual/components/"],

  /* Sidebar nav - Components section */
  body.pg-components main nav a[href$="/components/"],
  body.pg-typography main nav a[href$="typography.html"],
  body.pg-components-layout main nav a[href$="layout.html"],
  body.pg-schemes main nav a[href$="schemes.html"],
  body.pg-tables main nav a[href$="tables.html"],
  body.pg-media main nav a[href$="media.html"],
  body.pg-dividers main nav a[href$="dividers.html"],
  body.pg-forms main nav a[href$="forms.html"],
  body.pg-disclosure main nav a[href$="disclosure.html"],
  body.pg-navigation main nav a[href$="navigation.html"],

  /* Sidebar nav - Brand section */
  body.pg-brand-guide main nav a[href$="/brand/"],
  body.pg-logos main nav a[href$="logos.html"],
  body.pg-colors main nav a[href$="colors.html"],
  body.pg-fonts main nav a[href$="fonts.html"],
  body.pg-graphics main nav a[href$="graphics.html"],
  body.pg-voice-tone main nav a[href$="voice-tone.html"],
  body.pg-formatting main nav a[href$="formatting.html"],
  body.pg-audience main nav a[href$="audience.html"],

  /* Sidebar nav - Docs section */
  body.pg-docs main nav a[href$="/docs/"],
  body.pg-getting-started main nav a[href$="getting-started.html"],
  body.pg-structure main nav a[href$="structure.html"],
  body.pg-deployment main nav a[href$="deployment.html"],
  body.pg-docs-typography main nav a[href$="typography.html"],
  body.pg-utility-classes main nav a[href$="utility-classes.html"],
  body.pg-includes main nav a[href$="includes.html"],
  body.pg-design-toolbar main nav a[href$="design-toolbar.html"],
  body.pg-philosophy main nav a[href$="philosophy.html"],
  body.pg-process main nav a[href$="process.html"],
  body.pg-client-workflow main nav a[href$="client-workflow.html"],
  body.pg-content-workflow main nav a[href$="content-workflow.html"],
  body.pg-code-style main nav a[href$="code-style.html"],
  body.pg-accessibility main nav a[href$="accessibility.html"],
  body.pg-compatibility main nav a[href$="compatibility.html"],
  body.pg-support main nav a[href$="support.html"] {
    color: var(--color-fg);
    text-decoration: none;
  }

  /*
   * DARK MODE
   * Manual dark mode toggle for prototyping
   */
  .dark-mode {
    --color-bg: var(--color-grey-900);
    --color-fg: var(--color-white);
    --color-subtle: var(--color-grey-800);
    --color-border: var(--color-grey-700);
    --color-muted: var(--color-grey-400);
    background-color: var(--color-bg);
    color: var(--color-fg);
  }
}
