/**
 * Development & Prototyping Utilities
 *
 * These utilities are for design and development only.
 * Remove this file in production builds.
 */

@layer base {
  :root {
    --font-flow-block: 'Flow Block', sans-serif;
  }
}

@layer utilities {
  /* Development Grids - Visual guides for baseline and columns */

  /* Baseline Grid - Shows horizontal lines at each baseline increment */

  .show-baseline {
    /* Control subdivisions with --subdivisions (1 = no subdivisions, 2 = halves, 4 = quarters, etc.) */
    --subdivisions: 2;
    --baseline-transparency: 0.92; /* Make bg- classes slightly transparent to see grid */

    /* Main baseline grid at full line-height intervals */
    --baseline-grid: repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent calc(var(--line) - 1px),
      color-mix(in srgb, var(--color-fg) 25%, transparent) calc(var(--line) - 1px),
      color-mix(in srgb, var(--color-fg) 25%, transparent) var(--line)
    );

    /* Subdivision grid (lighter lines) - calculated based on --subdivisions */
    --subdivision-grid: repeating-linear-gradient(
      to bottom,
      transparent 0,
      transparent calc(var(--line) / var(--subdivisions) - 1px),
      color-mix(in srgb, var(--color-fg) 12%, transparent) calc(var(--line) / var(--subdivisions) - 1px),
      color-mix(in srgb, var(--color-fg) 12%, transparent) calc(var(--line) / var(--subdivisions))
    );

    /* Apply grid to body/root element */
    background-image: var(--baseline-grid), var(--subdivision-grid);
    background-size: 100% var(--line), 100% calc(var(--line) / var(--subdivisions));
    background-position: 0 0;
  }

  /* Make bg- classes slightly transparent so grid shows through */
  .show-baseline :is([class*="bg-"]):not(.bg-transparent) {
    background-color: color-mix(
      in srgb,
      var(--bg-color) var(--baseline-transparency),
      transparent
    ) !important;
  }

  /* Column Grid - Dynamic column overlay using CSS custom property */
  /* --dev-columns, --dev-gap are set by JavaScript */
  /* --dev-margin is set responsively based on data-margin-mode attribute */

  :root {
    --dev-columns: 3;
    --dev-gap: var(--gutter);
  }

  /* Column overlay - full viewport coverage */
  #dev-column-overlay {
    position: fixed;
    inset: 0;
    left: var(--dev-margin);
    right: var(--dev-margin);
    z-index: 9998;
    pointer-events: none;
    --col-width: calc((100% - var(--dev-gap) * (var(--dev-columns) - 1)) / var(--dev-columns));
    background: repeating-linear-gradient(
      to right,
      color-mix(in srgb, var(--color-accent, #0066ff) 8%, transparent) 0,
      color-mix(in srgb, var(--color-accent, #0066ff) 8%, transparent) var(--col-width),
      transparent var(--col-width),
      transparent calc(var(--col-width) + var(--dev-gap))
    );
    display: none;
  }

  .show-columns #dev-column-overlay {
    display: block;
  }

  /* Margin overlay - shows horizontal margins */
  #dev-margin-overlay {
    position: fixed;
    inset: 0;
    z-index: 9997;
    pointer-events: none;
    background: linear-gradient(
      to right,
      color-mix(in srgb, #ff6600 15%, transparent) 0,
      color-mix(in srgb, #ff6600 15%, transparent) var(--dev-margin),
      transparent var(--dev-margin),
      transparent calc(100% - var(--dev-margin)),
      color-mix(in srgb, #ff6600 15%, transparent) calc(100% - var(--dev-margin)),
      color-mix(in srgb, #ff6600 15%, transparent) 100%
    );
    display: none;
  }

  .show-margins #dev-margin-overlay {
    display: block;
  }

  /*
   * Responsive margin modes
   * These mirror the container queries in section.css using media queries
   * Since overlays are position:fixed, we use viewport width as a proxy
   */

  /* Section mode - matches .section responsive margins */
  #dev-column-overlay[data-margin-mode="section"],
  #dev-margin-overlay[data-margin-mode="section"] {
    --dev-margin: var(--horizontal-margin, var(--line-075));
  }

  /* Full-bleed mode - no margins */
  #dev-column-overlay[data-margin-mode="full-bleed"],
  #dev-margin-overlay[data-margin-mode="full-bleed"] {
    --dev-margin: 0;
  }

  /* Wide mode - matches .section-wide responsive margins */
  #dev-column-overlay[data-margin-mode="wide"],
  #dev-margin-overlay[data-margin-mode="wide"] {
    --dev-margin: var(--line-1);
  }

  /* Highlight .grid layout primitives when dev-outline-grids is active */
  body.dev-outline-grids .grid {
    position: relative;
  }

  body.dev-outline-grids .grid::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 9997;
    pointer-events: none;
    outline: 2px solid color-mix(in srgb, var(--color-accent, #0066ff) 60%, transparent);
    outline-offset: -2px;
    /* Show columns based on the grid's actual column count */
    background: repeating-linear-gradient(
      to right,
      color-mix(in srgb, var(--color-accent, #0066ff) 12%, transparent) 0,
      color-mix(in srgb, var(--color-accent, #0066ff) 12%, transparent) calc((100% - var(--dev-gap) * (var(--grid-columns, 3) - 1)) / var(--grid-columns, 3)),
      transparent calc((100% - var(--dev-gap) * (var(--grid-columns, 3) - 1)) / var(--grid-columns, 3)),
      transparent calc((100% - var(--dev-gap) * (var(--grid-columns, 3) - 1)) / var(--grid-columns, 3) + var(--dev-gap))
    );
  }

  /* Show grid info label */
  body.dev-outline-grids .grid::after {
    content: 'grid';
    position: absolute;
    top: 0;
    left: 0;
    background: var(--color-accent, #0066ff);
    color: white;
    font-size: 10px;
    font-family: var(--font-mono, monospace);
    padding: 2px 6px;
    z-index: 9998;
    pointer-events: none;
  }

  /*
   * PROTOTYPING FONTS
   * Special fonts for design and prototyping
   */
  .redact .prose,
  .redact .content {
    font-family: var(--font-flow-block);
  }

  /*
   * DARK MODE
   * Manual dark mode toggle for prototyping
   */
  .dark-mode {
    --color-bg: var(--color-grey-900);
    --color-fg: var(--color-white);
    --color-subtle: var(--color-grey-800);
    --color-border: var(--color-grey-700);
    --color-muted: var(--color-grey-400);
    background-color: var(--color-bg);
    color: var(--color-fg);
  }
}
